<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Internal users: agents can only access their own (or unassigned) properties -->
    <record id="estate_property_rule_user_own" model="ir.rule">
        <field name="name">Estate Property: agent own/unassigned</field>
        <field name="model_id" ref="model_estate_property"/>
        <field name="domain_force">['|', ('user_id', '=', user.id), ('user_id', '=', False)]</field>
        <field name="groups" eval="[(4, ref('hexclad_estate.estate_group_user'))]"/>
    </record>

    <!-- Managers must bypass agent restriction -->
    <record id="estate_property_rule_manager_all" model="ir.rule">
        <field name="name">Estate Property: manager full access</field>
        <field name="model_id" ref="model_estate_property"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('hexclad_estate.estate_group_manager'))]"/>
    </record>

    <!-- Offers follow property ownership for agents -->
    <record id="estate_property_offer_rule_user_own" model="ir.rule">
        <field name="name">Estate Property Offer: agent own properties</field>
        <field name="model_id" ref="model_estate_property_offer"/>
        <field name="domain_force">['|', ('property_id.user_id', '=', user.id), ('property_id.user_id', '=', False)]</field>
        <field name="groups" eval="[(4, ref('hexclad_estate.estate_group_user'))]"/>
    </record>

    <record id="estate_property_offer_rule_manager_all" model="ir.rule">
        <field name="name">Estate Property Offer: manager full access</field>
        <field name="model_id" ref="model_estate_property_offer"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('hexclad_estate.estate_group_manager'))]"/>
    </record>
</odoo>
